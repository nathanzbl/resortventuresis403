<!-- TEAM NOTE: Owner Registration Page matching login.ejs styling -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPV Owner Registration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-color: #0d47a1;
            --accent-color: #1e88e5;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .text-rpv-blue { color: var(--primary-color); }
        .bg-rpv-blue { background-color: var(--primary-color); }
        .hover\:bg-rpv-accent:hover { background-color: var(--accent-color); }

        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            min-width: 300px;
        }
        .success-box { background-color: #d1fae5; border: 2px solid #10b981; color: #065f46; }
        .error-box { background-color: #fee2e2; border: 2px solid #ef4444; color: #991b1b; }
    </style>
</head>
<body>

    <!-- Owner Registration Card -->
    <div class="w-full max-w-md bg-white p-8 md:p-10 rounded-xl shadow-2xl border border-gray-100">

        <!-- Header -->
        <div class="text-center mb-8">
            <svg class="mx-auto h-12 w-auto text-rpv-blue" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            <h2 class="mt-4 text-3xl font-extrabold text-gray-900">
                Owner Registration
            </h2>
            <p class="mt-2 text-sm text-gray-600">
                Create your Resort Property Ventures owner account
            </p>
        </div>

        <!-- Registration Form -->
        <form class="space-y-6" id="ownerRegForm" onsubmit="handleRegistration(event)">
            
            <div>
                <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
                <div class="mt-1">
                    <input id="username" name="username" type="text" required 
                        class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-rpv-accent focus:border-rpv-accent sm:text-sm"
                        placeholder="Choose a username">
                </div>
            </div>

            <div>
                <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                <div class="mt-1">
                    <input id="password" name="password" type="password" required minlength="6"
                        class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-rpv-accent focus:border-rpv-accent sm:text-sm"
                        placeholder="At least 6 characters">
                </div>
                <p class="mt-1 text-xs text-gray-500">Must be at least 6 characters long</p>
            </div>

            <div>
                <label for="confirmPassword" class="block text-sm font-medium text-gray-700">Confirm Password</label>
                <div class="mt-1">
                    <input id="confirmPassword" name="confirmPassword" type="password" required minlength="6"
                        class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-rpv-accent focus:border-rpv-accent sm:text-sm"
                        placeholder="Re-enter your password">
                </div>
            </div>

            <div>
                <button type="submit" 
                    class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-rpv-blue hover:bg-rpv-accent focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-rpv-accent transition duration-150 ease-in-out">
                    Register as Owner
                </button>
            </div>
        </form>

        <!-- Back to Login Link -->
        <div class="mt-6 text-center">
            <a href="/login" class="text-sm font-medium text-rpv-blue hover:text-rpv-accent">
                Already have an account? Sign in
            </a>
        </div>

    </div>

    <!-- Message Box -->
    <div id="messageBox" class="hidden message-box" role="alert">
        <p id="messageText" class="text-sm font-medium"></p>
        <button onclick="hideMessage()" class="mt-2 text-xs font-semibold px-3 py-1 bg-gray-700 text-white rounded hover:opacity-90">Close</button>
    </div>

    <script>
        function showMessage(message, isError = false) {
            const box = document.getElementById('messageBox');
            const text = document.getElementById('messageText');
            text.textContent = message;
            
            box.className = 'message-box ' + (isError ? 'error-box' : 'success-box');
            box.classList.remove('hidden');
        }

        function hideMessage() {
            document.getElementById('messageBox').classList.add('hidden');
        }

        async function handleRegistration(event) {
            event.preventDefault();

            const form = document.getElementById('ownerRegForm');
            const formData = new FormData(form);

            // Client-side password match check
            const password = formData.get('password');
            const confirmPassword = formData.get('confirmPassword');

            if (password !== confirmPassword) {
                showMessage('Passwords do not match!', true);
                return;
            }

            try {
                const response = await fetch('/register/owner', {
                    method: 'POST',
                    body: new URLSearchParams(formData),
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage('Registration successful! Redirecting to login...', false);
                    setTimeout(() => {
                        window.location.href = result.redirectTo;
                    }, 1500);
                } else {
                    showMessage(`Registration failed: ${result.message}`, true);
                }
            } catch (error) {
                console.error('Registration error:', error);
                showMessage('An unexpected error occurred during registration.', true);
            }
        }
    </script>
</body>
</html>